name: test trigger partner wf

on:
  workflow_dispatch:
    inputs:
      pending_matrix:
        description: json string of gh matrix (to be used with fromJson())
        type: string
        required: false
        default: '{"include": [{"resource_id": "rid", "version_id": "vid"}]}'

jobs:
  trigger_partners:
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        include:
        - owner: ilastik
          repo: bioimage-io-resources
          workflow: validate_bioimageio_resources.yaml

    steps:
    - name: escape json matrix string
      run: |
        python -c 'import json;s='"'"'{"pending_matrix": {"include": [{"resource_id": "rid", "version_id": "vid"}]}}'"'"';print(f"::set-output name=escaped::{json.dumps(s)}")'
    - name: trigger ${{ matrix.owner }}
      uses: benc-uk/workflow-dispatch@v1
      with:
        workflow: validate BioImage.IO resources
        repo: ${{ matrix.owner }}/${{ matrix.repo }}
        token: ${{ secrets.PAT }}
        inputs: '{"pending_matrix": "${{ steps.escape_matrix.outputs.escaped }}"'

#      run: |
#        curl \
#        -X POST \
#        -H "Accept: application/vnd.github.v3+json" \
#        -H "Authorization: token ${{ secrets.PAT }}" \
#        https://api.github.com/repos/${{ matrix.owner }}/${{ matrix.repo }}/actions/workflows/${{ matrix.workflow }}/dispatches \
#        -d '{"ref": "main", "inputs": {"pending_matrix": "$(${{ github.event.inputs.pending_matrix }} | sed 's/"/\\"/g')"}}'
